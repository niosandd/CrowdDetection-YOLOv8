# CrowdDetection-YOLOv8 — Полный пайплайн детекции людей в толпе

**Автор:** Никита  
**Дата:** 6 ноября 2025  

---

## Обзор проекта

Полный кросс-платформенный пайплайн для детекции людей в видео с толпой на основе **YOLOv8**.  
Проект включает **три независимых этапа**:

1. **Генерация датасета** из видео  
2. **Файн-тюнинг YOLOv8**  
3. **Инференс и аннотирование видео**  

Все скрипты оформлены по **PEP8**, с **docstrings**, **кросс-платформенностью**, поддержкой **Jupyter Lab** и чёткой структурой.

---


---

## 1. Генерация датасета

### Что сделано:
- Извлечены кадры из `crowd.mp4`  
- Проведена **псевдоразметка** с помощью `yolov8n.pt`  
- Датасет разделён на `train` / `val` (80/20)  
- Добавлены **синтетические данные**:
  - Аугментации (яркость, шум, дождь, туман, размытие)
  - **Copy-Paste** людей с масштабированием и случайным расположением  
- Сформирован `data.yaml` для YOLO

> Структура соответствует стандарту YOLOv8: `images/train`, `labels/train`, и т.д.

---

## 2. Обучение моделей

### Обучено **две модели**:
| Модель | Базовая | Эпохи | Размер | Примечание |
|--------|--------|-------|--------|-----------|
| `yolov8n.pt` | Nano | 100 | 640 | Лёгкая, быстрая |
| `yolov8s.pt` | Small | 100 | 640 | Точнее, чуть медленнее |

**Результаты сохранены в:**
- `runs/detect/crowd_finetune_n/weights/best.pt`
- `runs/detect/crowd_finetune_s/weights/best.pt`

---

## 3. Инференс и видео-вывод

### Сгенерированы **два аннотированных видео**:
- `N_output_video.mp4` — с моделью **yolov8n**
- `S_output_video.mp4` — с моделью **yolov8s**

### Особенности отрисовки:
- Зелёные bounding box  
- Метка: `person 0.xx` (уверенность)  
- Рамки **не перекрывают** людей  
- Текст читаем, шрифт компактный  

---

## Результаты

**Обе модели успешно детектируют людей в толпе.**  
- `yolov8s` показывает **более стабильные** и **уверенные** предсказания  
- `yolov8n` — быстрее, но с редкими **выбросами** (см. `1.png`)  

> **Выбросы**: модель иногда рисует bbox на фоне или с неправильной уверенностью — типично для слабой разметки и недостатка данных.
<img width="1137" height="591" alt="image" src="https://github.com/user-attachments/assets/c412db25-fccd-472b-8782-706264578b8b" />
---

## Установка

```bash
pip install -r requirements.txt

---
Оценка и перспективы развития
Обе модели (YOLOv8n и YOLOv8s) продемонстрировали высокую эффективность в детекции людей на тестовом видео, обеспечивая стабильное распознавание в условиях плотной толпы.
При наличии дополнительного времени проект мог бы быть расширен следующими направлениями:

Реализация детекции с нуля на PyTorch — разработка кастомной архитектуры (например, на базе EfficientNet или CSPNet), обучение с использованием специализированных функций потерь (Focal Loss, GIoU) и подбор оптимальных оптимизаторов (AdamW, SGD с расписанием).
Глубокая дообработка сгенерированного датасета — увеличение объёма данных за счёт многоэтапной генерации, фильтрации шумовых разметок и балансировки классов.
Тонкая настройка гиперпараметров — поиск по сетке или байесовская оптимизация для lr, weight decay, аугментаций и порогов NMS.

Такие улучшения позволили бы не только повысить точность, но и продемонстрировать глубокое понимание полного цикла разработки модели — от данных до деплоя.
